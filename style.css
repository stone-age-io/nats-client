/* --- RESET & GLOBAL --- */
*, *::before, *::after {
  box-sizing: border-box;
}

:root {
  --bg: #0a0a0a;
  --panel: #161616;
  --border: #333;
  --input-bg: #050505;
  --text: #e0e0e0;
  --muted: #888;
  
  /* Colors */
  --primary: #3fb950; /* GitHub Green */
  --primary-hover: #2ea043;
  --accent: #58a6ff;  /* GitHub Blue */
  --danger: #f85149;  /* GitHub Red */
  --warn: #d29922;    /* GitHub Orange */
  
  /* Fonts */
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  --mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
}

/* --- BASE --- */
html {
  max-width: 100vw;
  overflow-x: hidden;
}

body { 
  font-family: var(--font); 
  background: var(--bg); 
  color: var(--text); 
  margin: 0; 
  padding: 16px; 
  height: 100vh; 
  overflow-x: hidden; 
  overflow-y: hidden; 
  width: 100vw;
}

/* --- LAYOUT --- */
.main-layout { 
  display: grid; 
  grid-template-columns: 320px 1fr; 
  gap: 16px; 
  height: 100%; 
  overflow: hidden; 
  max-width: 100%;
}

.sidebar, .content { 
  display: flex; 
  flex-direction: column; 
  gap: 16px; 
  height: 100%; 
  min-height: 0; 
  overflow: hidden; 
  min-width: 0; 
}

.box { 
  background: var(--panel); 
  border: 1px solid var(--border); 
  padding: 16px; 
  border-radius: 6px; 
  display: flex; 
  flex-direction: column; 
  flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
  min-width: 0; 
}

.panel-content { 
  flex: 1; 
  min-height: 0; 
  display: flex; 
  flex-direction: column; 
  gap: 16px; 
  overflow: hidden; 
  min-width: 0;
}

.box-grow { 
  flex: 1; 
  min-height: 0; 
  overflow: hidden; 
}

.box-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 12px; 
  padding-bottom: 8px; 
  border-bottom: 1px solid var(--border); 
  flex-shrink: 0; 
}

h1 { margin: 0; font-size: 1.2rem; color: #fff; letter-spacing: 0.5px; font-weight: 700; white-space: nowrap; }
h3 { margin: 0; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); font-weight: 600; }

/* --- FORMS --- */
label { display: block; margin-bottom: 6px; font-size: 0.75rem; color: var(--muted); font-weight: 600; }

input, textarea, select { 
  width: 100%; 
  padding: 8px 12px; 
  background: var(--input-bg); 
  border: 1px solid var(--border); 
  color: #fff; 
  border-radius: 4px; 
  font-family: var(--mono); 
  font-size: 0.85rem; 
  margin-bottom: 10px; 
  transition: all 0.15s ease;
}

input:focus, textarea:focus, select:focus { 
  outline: none; 
  border-color: var(--accent); 
  box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.15);
}

#subPanel input#subSubject, 
.kv-editor input#kvKeyInput {
  width: auto;
  flex: 1;
  min-width: 0; 
}

.input-error {
  border-color: var(--danger) !important;
  background: rgba(248, 81, 73, 0.05) !important;
}

/* Custom File Input Styling */
input[type="file"] {
  padding: 6px;
  cursor: pointer;
}
input[type="file"]::file-selector-button {
  background: #21262d;
  color: #c9d1d9;
  border: 1px solid rgba(240,246,252,0.1);
  padding: 6px 12px;
  border-radius: 4px;
  margin-right: 12px;
  cursor: pointer;
  font-weight: 600;
  font-family: var(--font);
  font-size: 0.75rem;
  transition: all 0.2s;
}
input[type="file"]::file-selector-button:hover {
  background: #30363d;
  color: #fff;
  border-color: #8b949e;
}

textarea { resize: vertical; min-height: 80px; line-height: 1.4; }

.filter-input { 
  background: var(--input-bg) !important; 
  padding: 4px 8px !important; 
  margin: 0 !important; 
  width: 180px !important; 
  font-size: 0.8rem !important; 
}

.sm-input { 
  padding: 6px !important; 
  font-size: 0.8rem !important; 
  margin-bottom: 0 !important; 
  text-align: center; 
}

/* --- BUTTONS --- */
button { 
  background: #21262d; 
  color: #c9d1d9; 
  border: 1px solid rgba(240,246,252,0.1); 
  padding: 8px 16px; 
  border-radius: 4px; 
  cursor: pointer; 
  font-weight: 600; 
  font-size: 0.85rem; 
  transition: all 0.2s; 
}

button:hover { background: #30363d; border-color: #8b949e; color: #fff; }
button:active { transform: translateY(1px); }
button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

button.primary { background: var(--primary); color: #fff; border: 1px solid rgba(240,246,252,0.1); }
button.primary:hover { background: var(--primary-hover); }

button.accent { background: #1f6feb; color: #fff; border: none; }
button.accent:hover { background: #388bfd; }

button.danger { color: var(--danger); border-color: rgba(248,81,73,0.4); background: transparent; padding: 4px 10px; font-size: 0.75rem; }
button.danger:hover { background: rgba(248,81,73,0.1); border-color: var(--danger); }

button.icon-btn { padding: 0; width: 36px; height: 36px; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

button.sm-btn { padding: 4px 8px; font-size: 0.75rem; background: transparent; border: 1px solid var(--border); }
button.sm-btn:hover { background: #21262d; }

button.paused { background: rgba(210, 153, 34, 0.2); color: var(--warn); border-color: var(--warn); }

.copy-btn { background: transparent; border: none; color: var(--muted); cursor: pointer; padding: 2px 6px; font-size: 0.7rem; margin-left: auto; opacity: 0.6; }
.copy-btn:hover { color: var(--accent); opacity: 1; background: rgba(88,166,255,0.1); border-radius: 4px; }

/* --- TABS --- */
.tab-bar { display: flex; gap: 8px; margin-bottom: 8px; flex-shrink: 0; }
.tab-btn { 
  background: transparent; border: none; color: var(--muted); 
  padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 600; 
  border-bottom: 2px solid transparent;
  border-radius: 4px 4px 0 0;
}
.tab-btn.active { color: #fff; border-bottom-color: var(--accent); background: rgba(255,255,255,0.05); }
.tab-btn:hover:not(.active) { color: #e0e0e0; background: rgba(255,255,255,0.03); }

/* --- LISTS & SCROLL --- */
.scroll-container, #messages { 
  flex: 1; min-height: 0; overflow-y: auto; 
  background: #0d1117; border: 1px solid var(--border); border-radius: 6px; 
}
#messages { padding: 12px; font-family: var(--mono); font-size: 0.8rem; }

#subList { list-style: none; padding: 0; margin: 0; }
#subList li { 
  background: transparent; 
  border-bottom: 1px solid #21262d; 
  border-left: 3px solid transparent;
  padding: 8px 12px; 
  display: flex; justify-content: space-between; align-items: center; 
  transition: background 0.1s;
}
#subList li:hover { background: #161b22; }
#subList li.active-sub { border-left-color: var(--accent); background: #161b22; }
#subList li span { font-family: var(--mono); font-size: 0.8rem; color: #c9d1d9; word-break: break-all; margin-right: 10px; }

/* --- LOG ENTRIES --- */
.msg-entry { margin-bottom: 12px; border-bottom: 1px solid #21262d; padding-bottom: 8px; animation: fadeIn 0.1s ease-out; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(2px); } to { opacity: 1; transform: translateY(0); } }

.msg-meta { margin-bottom: 6px; color: var(--muted); font-size: 0.75em; display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.badge { padding: 2px 6px; border-radius: 10px; font-weight: 600; font-size: 0.7em; letter-spacing: 0.5px; text-transform: uppercase; }
.badge-sub { background: rgba(63, 185, 80, 0.2); color: #56d364; border: 1px solid rgba(63, 185, 80, 0.4); }
.badge-rpc { background: rgba(88, 166, 255, 0.2); color: #79c0ff; border: 1px solid rgba(88, 166, 255, 0.4); }
.badge-hdr { background: rgba(210, 153, 34, 0.2); color: #e3b341; border: 1px solid rgba(210, 153, 34, 0.4); font-size: 0.7em; padding: 1px 5px; }

pre { margin: 0; color: #c9d1d9; white-space: pre-wrap; word-break: break-all; line-height: 1.5; }

/* --- KV STORE & STREAMS --- */
.kv-layout { display: grid; grid-template-columns: 280px 1fr; gap: 16px; height: 100%; min-height: 0; }
.kv-list { overflow-y: auto; border-right: 1px solid var(--border); padding-right: 12px; display: flex; flex-direction: column; gap: 2px; }
.kv-editor { display: flex; flex-direction: column; gap: 12px; overflow-y: auto; padding-right: 12px; }

.kv-key { 
  padding: 8px 10px; cursor: pointer; border-radius: 4px;
  font-family: var(--mono); font-size: 0.8rem; color: var(--text); word-break: break-all;
}
.kv-key:hover { background: #21262d; color: #fff; }
.kv-key.active { background: rgba(88, 166, 255, 0.15); color: var(--accent); font-weight: 600; }
.kv-empty { color: var(--muted); font-style: italic; padding: 30px; text-align: center; font-size: 0.9rem; }

/* Stream Info Grid */
.info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.info-item { background: rgba(255,255,255,0.03); padding: 8px; border-radius: 4px; }
.info-item label { margin-bottom: 2px; font-size: 0.7rem; color:var(--muted); display:block; }
.info-item span { font-family: var(--mono); font-size: 0.9rem; word-break: break-all; }

/* --- UTILS --- */
.status-dot { width: 8px; height: 8px; border-radius: 50%; background: #444; display: inline-block; margin-right: 8px; transition: all 0.3s; flex-shrink: 0; }
.status-dot.connected { background: var(--primary); box-shadow: 0 0 8px rgba(63, 185, 80, 0.6); }
/* New Reconnecting State */
.status-dot.reconnecting { background: var(--warn); box-shadow: 0 0 8px rgba(210, 153, 34, 0.6); }

.modal-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.7); backdrop-filter: blur(2px); z-index: 100; display: none;
  justify-content: center; align-items: center;
}
.modal {
  background: #1c2128; border: 1px solid #30363d; color: #c9d1d9;
  padding: 24px; border-radius: 8px; width: 600px; max-width: 90%;
  box-shadow: 0 20px 40px rgba(0,0,0,0.6);
}
.modal pre { background: #0d1117; padding: 16px; border-radius: 6px; border: 1px solid #30363d; max-height: 400px; overflow: auto; }

/* --- TOASTS --- */
#toast-container {
  position: fixed; 
  bottom: 24px; 
  right: 24px; 
  z-index: 2000;
  display: flex; 
  flex-direction: column; 
  gap: 12px; 
  pointer-events: none;
}

.toast {
  background: #1f242c; color: #fff; padding: 14px 18px; border-radius: 6px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5); border-left: 4px solid #555;
  font-size: 0.9rem; min-width: 280px; pointer-events: auto;
  display: flex; align-items: center; justify-content: space-between;
  animation: slideInBottom 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}
.toast.success { border-left-color: var(--primary); }
.toast.error { border-left-color: var(--danger); }
.toast.info { border-left-color: var(--accent); }
.toast.hiding { animation: fadeOutRight 0.2s ease-in forwards; }

@keyframes slideInBottom { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
@keyframes fadeOutRight { to { transform: translateX(10px); opacity: 0; } }

/* --- SCROLLBARS --- */
::-webkit-scrollbar { width: 10px; height: 10px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #30363d; border-radius: 5px; border: 2px solid var(--panel); }
::-webkit-scrollbar-thumb:hover { background: #484f58; }

/* --- MOBILE / TABLET --- */
@media (max-width: 768px) {
  body { 
    height: auto; 
    overflow-y: auto; 
    padding: 12px; 
    touch-action: manipulation;
    width: 100vw;
    overflow-x: hidden;
  }
  
  .main-layout { grid-template-columns: 1fr; height: auto; overflow: visible; }
  .sidebar, .content { height: auto; overflow: visible; gap: 12px; }
  .panel-content { display: block; height: auto; overflow: visible; }
  
  #panelMsg .box-grow { flex: none; height: 500px; min-height: 500px; }
  #panelKv .box-grow { flex: none; height: auto; overflow: visible; }
  
  .box-header { flex-wrap: wrap; }
  .box-header > div { flex: 1; width: 100%; justify-content: flex-end; }

  .filter-input { width: auto !important; flex-grow: 1; min-width: 60px; }
  .pub-row { flex-direction: column; gap: 12px; }
  .pub-actions { width: 100%; display: flex; flex-direction: row; gap: 12px; margin-top: 0; }
  .pub-actions button { flex: 1; }
  
  .kv-layout { display: flex; flex-direction: column; gap: 16px; }
  .kv-list { 
    height: 180px; 
    min-height: 180px;
    border-right: none; 
    border-bottom: 1px solid var(--border); 
    padding-bottom: 12px; 
  }
  
  .kv-editor { min-height: 300px; }
  .info-grid { grid-template-columns: 1fr; }
  
  #kvValueInput { height: 200px !important; }
  
  #toast-container { 
    left: 12px; 
    right: 12px; 
    bottom: 12px; 
    width: calc(100% - 24px);
    max-width: 100%;
  }
  .toast { min-width: 0; width: 100%; white-space: normal; word-break: break-word; }
  
  input, textarea, select,
  input[type="text"], input[type="password"], input[type="number"], input[type="file"] {
    font-size: 16px !important;
  }

  button, .tab-btn { min-height: 44px; padding: 8px 16px; touch-action: manipulation; }

  pre { max-width: 100%; overflow-x: auto; white-space: pre-wrap; }
}

/* --- SYNTAX HIGHLIGHTING --- */
.key { color: #79c0ff; }      /* Blue */
.string { color: #a5d6ff; }   /* Light Blue */
.number { color: #7ee787; }   /* Green */
.boolean { color: #56d364; }  /* Green */
.null { color: #f85149; }     /* Red */

/* --- SORT INDICATOR --- */
.sort-indicator {
  font-size: 0.65rem;
  color: var(--muted);
  border: 1px solid #333;
  padding: 2px 6px;
  border-radius: 4px;
  background: rgba(0,0,0,0.2);
  cursor: help;
  white-space: nowrap;
}
